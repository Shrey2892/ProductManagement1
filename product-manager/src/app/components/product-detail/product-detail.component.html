<app-product-layout></app-product-layout>

<div class="product-container" *ngIf="product">
  
  <!-- Ambient Background -->
  <div class="ambient-bg">
    <div class="ambient-orb orb-1"></div>
    <div class="ambient-orb orb-2"></div>
    <div class="ambient-orb orb-3"></div>
  </div>

  <!-- Product Hero Section -->
  <div class="product-hero">
    <div class="hero-content">
      
      <!-- Breadcrumb Navigation -->
      <nav aria-label="breadcrumb" class="breadcrumb-nav">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/products">Home</a></li>
          <li class="breadcrumb-item"><a routerLink="/products">{{ product.category || 'Products' }}</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
        </ol>
      </nav>

      <!-- Main Product Grid -->
      <div class="product-grid">
        
        <!-- Left: Image Gallery -->
        <div class="image-section">
          <div class="main-image-wrapper">
            <img [src]="product.imageUrl" [alt]="product.name" class="main-product-image" />
            <span class="stock-badge" [ngClass]="product.stockQuantity > 0 ? 'in-stock' : 'out-of-stock'">
              {{ product.stockQuantity > 0 ? 'In Stock' : 'Out of Stock' }}
            </span>
          </div>
          
          <!-- Thumbnail Gallery -->
          <div class="thumbnail-gallery">
            <div class="thumbnail-item active">
              <img [src]="product.imageUrl" [alt]="product.name" />
            </div>
          </div>
        </div>

        <!-- Center: Product Information -->
        <div class="product-info">
          <div class="product-header">
            <div class="header-top">
              <span class="category-tag" *ngIf="product.category">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                  <path d="M3 7h18M3 12h18M3 17h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                {{ product.category }}
              </span>
              <div class="trust-badges">
                <span class="badge-item" title="Verified Product">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>Verified</span>
                </span>
                <span class="badge-item" title="Fast Shipping">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                    <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>Fast Ship</span>
                </span>
              </div>
            </div>
            <h1 class="product-title">{{ product.name }}</h1>
            
            <!-- Rating Summary -->
            <div class="rating-summary">
              <div class="stars-container">
                <div class="stars">
                  <span *ngFor="let star of [1,2,3,4,5]" class="star" [ngClass]="star <= averageRating() ? 'filled' : 'empty'">★</span>
                </div>
                <span class="rating-value">{{ averageRating() || '0' }}</span>
              </div>
              <span class="rating-divider">•</span>
              <span class="rating-text">{{ reviews.length }} {{ reviews.length === 1 ? 'review' : 'reviews' }}</span>
              <span class="rating-divider">•</span>
              <span class="sold-count">{{ product.stockQuantity > 50 ? '100+' : product.stockQuantity * 2 }} sold</span>
            </div>
          </div>

          <div class="price-section">
            <div class="price-wrapper">
              <div class="current-price">₹{{ product.price }}</div>
              <div class="price-details">
                <span class="tax-info">Incl. of all taxes</span>
              </div>
            </div>
            <div class="payment-badges">
              <span class="payment-badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M2 10h20" stroke="currentColor" stroke-width="2"/>
                </svg>
                Secure Payment
              </span>
              <span class="payment-badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M9 11l3 3L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Easy Returns
              </span>
            </div>
          </div>

          <p class="product-description">{{ product.description || 'No description available.' }}</p>

          <!-- Product Specifications -->
          <div class="specifications">
            <div class="spec-item">
              <div class="spec-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="spec-content">
                <span class="spec-label">SKU Code</span>
                <span class="spec-value">{{ product.sku || '—' }}</span>
              </div>
            </div>
            <div class="spec-item">
              <div class="spec-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="spec-content">
                <span class="spec-label">Stock Available</span>
                <span class="spec-value">{{ product.stockQuantity }} units</span>
              </div>
            </div>
            <div class="spec-item">
              <div class="spec-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="spec-content">
                <span class="spec-label">Delivery Time</span>
                <span class="spec-value">2-4 days • Free</span>
              </div>
            </div>
          </div>

          <!-- Quantity & Actions -->
          <div class="purchase-controls">
            <div class="quantity-selector">
              <button class="qty-btn" (click)="decrementQuantity()" [disabled]="quantity<=1 || product.stockQuantity === 0">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
              <input type="number" [(ngModel)]="quantity" min="1" [max]="product.stockQuantity" class="qty-input" [disabled]="product.stockQuantity === 0" />
              <button class="qty-btn" (click)="incrementQuantity()" [disabled]="quantity>=product.stockQuantity || product.stockQuantity === 0">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>

            <div class="action-buttons">
              <button class="btn-add-cart" (click)="addToCart()" [disabled]="product.stockQuantity === 0">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M9 2L7.17 4M15 2l1.83 2M3.5 9.09h17M6.5 20h11c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2h-11c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Add to Cart</span>
              </button>
              <button class="btn-wishlist" (click)="toggleWishlist()" [disabled]="wishlistLoading" [ngClass]="{'active': inWishlist}">
                <svg width="20" height="20" viewBox="0 0 24 24" [attr.fill]="inWishlist ? 'currentColor' : 'none'">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="stock-notice" *ngIf="product.stockQuantity <= 5">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M8 1l1.5 3 3.5.5-2.5 2.5.5 3.5L8 9l-3 1.5.5-3.5L3 4.5l3.5-.5L8 1z" fill="#f59e0b"/>
            </svg>
            <span>Only {{ product.stockQuantity }} left in stock — order soon!</span>
          </div>
        </div>

        <!-- Right: Reviews Sidebar -->
        <div class="reviews-sidebar">
          <div class="reviews-header">
            <h3>Customer Reviews</h3>
            <div class="review-score">
              <div class="score-number">{{ averageRating() || '—' }}</div>
              <div class="score-details">
                <div class="stars-large">
                  <span *ngFor="let star of [1,2,3,4,5]" class="star" [ngClass]="star <= averageRating() ? 'filled' : 'empty'">★</span>
                </div>
                <div class="review-count">Based on {{ reviews.length }} {{ reviews.length === 1 ? 'review' : 'reviews' }}</div>
              </div>
            </div>
          </div>

          <!-- Review List -->
          <div class="reviews-list">
            <div class="review-card" *ngFor="let review of reviews">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">{{ review.author.charAt(0).toUpperCase() }}</div>
                  <div class="reviewer-details">
                    <div class="reviewer-name">{{ review.author }}</div>
                    <div class="review-date">{{ review.date }}</div>
                  </div>
                </div>
                <div class="review-rating">
                  <span *ngFor="let star of [1,2,3,4,5]" class="star" [ngClass]="star <= review.rating ? 'filled' : 'empty'">★</span>
                </div>
              </div>
              <p class="review-text">{{ review.text }}</p>
            </div>
          </div>

          <!-- Write Review Form -->
          <div class="review-form">
            <h4>Write a Review</h4>
            <div class="form-group">
              <label>Your Name</label>
              <input type="text" [(ngModel)]="newReview.author" placeholder="Enter your name (optional)" class="form-input" />
            </div>
            <div class="form-group">
              <label>Rating</label>
              <select [(ngModel)]="newReview.rating" class="form-select">
                <option *ngFor="let v of [5,4,3,2,1]" [value]="v">{{ v }} star{{ v > 1 ? 's' : '' }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Your Review</label>
              <textarea [(ngModel)]="newReview.text" rows="4" placeholder="Share your experience with this product..." class="form-textarea"></textarea>
            </div>
            <button class="btn-submit-review" (click)="submitReview()">
              <span>Submit Review</span>
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M1 8h14M9 2l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

</div>
