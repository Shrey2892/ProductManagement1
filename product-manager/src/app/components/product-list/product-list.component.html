<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
  <div class="container-fluid">

    <a class="navbar-brand fw-bold me-4" routerLink="/products">
      <i class="bi bi-box-seam me-1"></i> ProdigyHub
    </a>

    
    <button 
      class="navbar-toggler" 
      type="button" 
      data-bs-toggle="collapse" 
      data-bs-target="#navbarNav" 
      aria-controls="navbarNav" 
      aria-expanded="false" 
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    
    <div class="collapse navbar-collapse" id="navbarNav">

      
      <div class="search-bar-container d-none d-lg-block">
        <form class="d-flex w-100" role="search">
          <div class="input-group w-100">
            <input
              type="text"
              class="form-control"
              placeholder="Search products..."
              aria-label="Search products"
              [(ngModel)]="searchQuery"
              (input)="onSearch()"
              name="search"
              ngModel
            />
            <span class="input-group-text bg-white">
              <i class="bi bi-search text-primary"></i>
            </span>
          </div>
        </form>
      </div>

      
      <ul class="navbar-nav ms-auto align-items-center">

        
        

 
  <li class="nav-item" *ngIf="isAdmin">
    <a class="nav-link active" routerLink="/create-product">Add Product</a>
  </li>


  <li class="nav-item" *ngIf="isAdmin">
    <a class="nav-link active" routerLink="/users">
      <i class="bi bi-people me-1"></i> Users
    </a>
  </li>

  <li class="nav-item" *ngIf="isAdmin">
    <a class="nav-link active" routerLink="/add-user">
      <i class="bi bi-people me-1"></i> Add User
    </a>
  </li>

   <!-- <li class="nav-item me-2" *ngIf="isUser">
    <a class="nav-link position-relative" routerLink="/cart">
      <i class="bi bi-cart3 fs-5"></i>
      
      <span *ngIf="cartCount > 0" 
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ cartCount }}
      </span>
      
    </a>
  </li> -->
<li class="nav-item me-2" *ngIf="isUser">
  <a class="nav-link position-relative d-flex align-items-center" routerLink="/wishlist">
    <div class="position-relative d-inline-block">
      <i class="bi bi-heart fs-4 text-white"></i>
      <span *ngIf="wishlistCount > 0"
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning shadow-sm wishlist-badge">
        {{ wishlistCount }}
      </span>
    </div>
  </a>
</li>




  <li class="nav-item me-2" *ngIf="isUser">
  <a class="nav-link position-relative d-flex align-items-center" routerLink="/cart">
    <div class="position-relative d-inline-block">
    <i class="bi bi-cart3 fs-4"></i>
    <span *ngIf="cartCount > 0" 
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger shadow-sm cart-badge">
      {{ cartCount }}
    </span>
    </div>
  </a>
</li>

        <li class="nav-item" *ngIf="!user">
          <a class="nav-link" routerLink="/login">Login</a>
        </li>

        <!-- User Dropdown -->
        <li class="nav-item dropdown" *ngIf="user">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button"
             data-bs-toggle="dropdown" aria-expanded="false">
            <ng-container *ngIf="avatarUrl; else defaultAvatar">
              <img
                [src]="avatarUrl"
                [alt]="user.username + ' avatar'"
                class="rounded-circle border border-white me-2  profile-avatar"
                style="width: 32px; height: 32px; object-fit: cover;"
              />
            </ng-container>
            <ng-template #defaultAvatar>
              <div
                class="rounded-circle bg-light text-primary d-flex justify-content-center align-items-center border border-white me-2  profile-avatar"
                style="width: 32px; height: 32px; font-weight: 600; font-size: 1rem; user-select: none;">
                {{ user.username.charAt(0) | uppercase }}
              </div>
            </ng-template>
            {{ user.username }}
          </a>
          <!-- <ul class="dropdown-menu dropdown-menu-end mt-2" aria-labelledby="userDropdown"> -->
             <ul class="dropdown-menu dropdown-menu-end mt-2" aria-labelledby="userDropdown">
            <li class="px-3 py-2">
              <span class="fw-semibold">{{ user.role }}</span>
            </li>
            
            <li><hr class="dropdown-divider" /></li>
            <li>
              <button class="dropdown-item" (click)="goToEditProfile()">Edit Profile</button>
            </li>
            <li>
              <button class="dropdown-item text-danger" (click)="logout()">Logout</button>
            </li>
          </ul>
        </li>

        <!-- Search Bar (mobile only, inside dropdown) -->
        <li class="nav-item w-100 d-lg-none mt-2">
          <form class="d-flex w-100" role="search">
            <div class="input-group w-100">
              <input
                type="text"
                class="form-control"
                placeholder="Search products..."
                aria-label="Search products"
                [(ngModel)]="searchQuery"
                (input)="onSearch()"
                name="searchMobile"
                ngModel
              />
              <span class="input-group-text bg-white">
                <i class="bi bi-search text-primary"></i>
              </span>
            </div>
          </form>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- MAIN CONTENT -->
<div class="main p-3">

  <!-- PRODUCT GRID -->
  <div *ngIf="products.length; else noProducts" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
    <!-- <div *ngFor="let p of filteredProducts" class="col"> -->
      <div *ngFor="let p of paginatedProducts" class="col">

      
      <!-- <div class="card h-100 custom-card-width" [class.bg-light]="!p.isActive"> -->
        <!-- <div class="card h-100 custom-card-width" 
         [ngClass]="{'opacity-50 pointer-events-none':isUser && !p.isActive}"
         [class.bg-light]="!p.isActive">
        <img *ngIf="p.imageUrl"
             [src]="p.imageUrl"
             class="card-img-top"
             [alt]="p.name"
             style="height: 180px; object-fit: cover;" />
             <button 
      class="btn btn-light position-absolute top-0 end-0 m-2 rounded-circle shadow"
      *ngIf="isUser"
      (click)="toggleWishlist(p)">
      <i [class]="isInWishlist(p.id) ? 'bi bi-heart-fill text-danger' : 'bi bi-heart text-dark'"></i>
    </button> -->

    <div class="card h-100 custom-card-width position-relative"
     [ngClass]="{'opacity-50 pointer-events-none': isUser && p.stockQuantity === 0}"
     [class.bg-light]="p.stockQuantity === 0"
     style="position: relative;">

  <!-- Product Image -->
  <img *ngIf="p.imageUrl"
       [src]="p.imageUrl"
       class="card-img-top"
       [alt]="p.name"
      style="height: 340px; object-fit: cover;"
/>

  <!-- Wishlist Button -->
  <button 
    class="btn btn-light position-absolute top-0 end-0 m-2 rounded-circle shadow"
    *ngIf="isUser"
    (click)="toggleWishlist(p)">
    <i [class]="isInWishlist(p.id) ? 'bi bi-heart-fill text-danger' : 'bi bi-heart text-dark'"></i>
  </button>

  <!-- Out of Stock Badge -->
  <div *ngIf="p.stockQuantity === 0"
       class="position-absolute top-50 start-50 translate-middle bg-dark text-white px-3 py-1 rounded shadow">
    Out of Stock
  </div>




        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ p.name }}</h5>
          <!-- <p class="card-text text-muted mb-1">{{ p.description }}</p> -->
          <p class="card-text mb-1"><strong>Category:</strong> {{ p.category }}</p>
          <!-- <p class="card-text mb-1"><strong>SKU:</strong> {{ p.sku }}</p> -->
          <p class="card-text mb-1">
            <strong>Price:</strong> Rs. {{ p.price.toFixed(2) }} 
            <!-- <strong>Stock:</strong> {{ p.stockQuantity }} -->
          </p>

          <div class="mt-auto">
            <div class="btn-group btn-group-sm w-100" role="group">
              <button class="btn btn-info text-white" (click)="view(p.id)">View</button>
              
               <button class="btn btn-warning text-dark" *ngIf="isAdmin" (click)="edit(p.id)">Edit</button>
                
                

              <!-- <button class="btn btn-danger" (click)="remove(p.id)">Delete</button> -->
               <button class="btn btn-danger" *ngIf="isAdmin" (click)="remove(p.id)">Delete</button>
               <button class="btn btn-success" *ngIf="isUser"  (click)="addToCart(p)" [disabled]="p.stockQuantity === 0">
    <i class="bi bi-cart-plus"></i> Add
  </button>
  
  <!-- <button class="btn btn-outline-danger btn-sm"  *ngIf ="isUser" (click)="toggleWishlist(p)">
            <i [class]="isInWishlist ? 'bi bi-heart-fill text-danger' : 'bi bi-heart'"></i>
          </button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <nav
  *ngIf="filteredProducts.length > itemsPerPage"
  class="d-flex justify-content-center mt-5"
>
  <ul class="pagination pagination-lg shadow-sm rounded-pill bg-white px-3 py-2 align-items-center">

    <!-- Previous -->
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link rounded-pill px-4"
              (click)="prevPage()">
        ← Previous
      </button>
    </li>

    <!-- Page Info -->
    <li class="page-item mx-3">
      <span class="page-info fw-semibold text-primary">
        Page {{ currentPage }} of {{ totalPages }}
      </span>
    </li>

    <!-- Next -->
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link rounded-pill px-4"
              (click)="nextPage()">
        Next →
      </button>
    </li>

  </ul>
</nav>


  <!-- NO PRODUCTS TEMPLATE -->
  <ng-template #noProducts>
    <p class="text-muted fst-italic">No products available.</p>
  </ng-template>

  
</div>



<style>
/* Ensure the search bar is truly centered */
.search-bar-container {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 400px;
}
</style>
