<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
  <div class="container-fluid">

    <a class="navbar-brand fw-bold me-4" routerLink="/products">
      <i class="bi bi-box-seam me-1"></i> ProdigyHub
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
      data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

      <div class="search-bar-container d-none d-lg-block">
        <form class="d-flex w-100" role="search">
          <div class="input-group w-100">
            <input type="text" class="form-control" placeholder="Search products..."
              [(ngModel)]="searchQuery" (input)="onSearch()" name="search" ngModel />
            <span class="input-group-text bg-white">
              <i class="bi bi-search text-primary"></i>
            </span>
          </div>
        </form>
      </div>

      <ul class="navbar-nav ms-auto align-items-center">

        <li class="nav-item" *ngIf="isAdmin">
          <a class="nav-link active" routerLink="/create-product">Add Product</a>
        </li>
        <li class="nav-item" *ngIf="isAdmin">
          <a class="nav-link active" routerLink="/users">
            <i class="bi bi-people me-1"></i> Users
          </a>
        </li>
        <li class="nav-item" *ngIf="isAdmin">
          <a class="nav-link active" routerLink="/add-user">
            <i class="bi bi-people me-1"></i> Add User
          </a>
        </li>

        <li class="nav-item me-2" *ngIf="isUser">
          <a class="nav-link position-relative d-flex align-items-center" routerLink="/wishlist">
            <div class="position-relative d-inline-block">
              <i class="bi bi-heart fs-4 text-white"></i>
              <span *ngIf="wishlistCount > 0"
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning shadow-sm">
                {{ wishlistCount }}
              </span>
            </div>
          </a>
        </li>

        <li class="nav-item me-2" *ngIf="isUser">
          <a class="nav-link position-relative d-flex align-items-center" routerLink="/cart">
            <div class="position-relative d-inline-block">
              <i class="bi bi-cart3 fs-4"></i>
              <span *ngIf="cartCount > 0"
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger shadow-sm">
                {{ cartCount }}
              </span>
            </div>
          </a>
        </li>

        <li class="nav-item" *ngIf="!user">
          <a class="nav-link" routerLink="/login">Login</a>
        </li>

        <li class="nav-item dropdown" *ngIf="user">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown"
            role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <ng-container *ngIf="avatarUrl; else defaultAvatar">
              <img [src]="avatarUrl" [alt]="user.username + ' avatar'"
                class="rounded-circle border border-white me-2"
                style="width: 32px; height: 32px; object-fit: cover;" />
            </ng-container>
            <ng-template #defaultAvatar>
              <div class="rounded-circle bg-light text-primary d-flex justify-content-center align-items-center border border-white me-2"
                style="width: 32px; height: 32px; font-weight: 600; font-size: 1rem; user-select: none;">
                {{ user.username.charAt(0) | uppercase }}
              </div>
            </ng-template>
            {{ user.username }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end mt-2" aria-labelledby="userDropdown">
            <li class="px-3 py-2"><span class="fw-semibold">{{ user.role }}</span></li>
            <li><hr class="dropdown-divider" /></li>
            <li><button class="dropdown-item" (click)="goToEditProfile()">Edit Profile</button></li>
            <li><button class="dropdown-item text-danger" (click)="logout()">Logout</button></li>
          </ul>
        </li>

        <li class="nav-item w-100 d-lg-none mt-2">
          <form class="d-flex w-100" role="search">
            <div class="input-group w-100">
             <input
  type="text"
  class="form-control"
  placeholder="Search products, category..."
  [(ngModel)]="searchQuery"
  (input)="onSearch()"
  name="search"
/>
              <span class="input-group-text bg-white">
                <i class="bi bi-search text-primary"></i>
              </span>
            </div>
          </form>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- ══════════════════════════════════════
     CATEGORY HORIZONTAL GRID
══════════════════════════════════════ -->
<div class="cat-grid-bar">
  <div class="cat-grid-inner">

    <!-- All -->
    <button class="cat-grid-item" [class.active]="selectedCategory === 'All'"
            (click)="selectCategory('All')">
      <div class="cat-icon-wrap">
        <i class="bi bi-grid-3x3-gap-fill"></i>
      </div>
      <span class="cat-label">All</span>
    </button>

    <!-- Dynamic categories -->
    <button *ngFor="let cat of allCategories"
            class="cat-grid-item"
            [class.active]="selectedCategory === cat"
            (click)="selectCategory(cat)">
      <div class="cat-icon-wrap">
        <!-- Map category name to a fitting Bootstrap Icon -->
        <i [class]="getCategoryIcon(cat)"></i>
      </div>
      <span class="cat-label">{{ cat }}</span>
    </button>

  </div>
</div>

<!-- ══════════════════════════════════════
     MAIN CONTENT
══════════════════════════════════════ -->
<div class="main-content p-3">

  <ng-container *ngIf="products.length; else noProducts">

    <!-- Result info -->
    <div class="result-info mb-3 d-flex align-items-center justify-content-between flex-wrap gap-2">
      <p class="mb-0 text-muted small">
        Showing <strong>{{ displayedProducts.length }}</strong> product(s)
        <span *ngIf="selectedCategory !== 'All'"> in <strong>{{ selectedCategory }}</strong></span>
      </p>
      <button *ngIf="selectedCategory !== 'All'" class="clear-btn" (click)="selectCategory('All')">
        <i class="bi bi-x-circle me-1"></i>Clear filter
      </button>
    </div>

    <!-- Product Grid -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
      <div *ngFor="let p of paginatedProducts" class="col">

       <div
  class="card h-100 border-0 shadow-sm product-card position-relative"
  [class.is-oos-user]="p.stockQuantity === 0 && isUser"
  [class.is-oos-admin]="p.stockQuantity === 0 && isAdmin"
>

          <!-- Wishlist -->
          <button class="wishlist-btn" *ngIf="isUser" (click)="toggleWishlist(p)">
            <i [class]="isInWishlist(p.id) ? 'bi bi-heart-fill text-danger' : 'bi bi-heart'"></i>
          </button>

          <!-- Out of Stock overlay -->
          <div *ngIf="p.stockQuantity === 0" class="oos-overlay">
            <span>Out of Stock</span>
          </div>

          <!-- Inactive badge -->
          <span *ngIf="isAdmin && !p.isActive" class="inactive-badge">Inactive</span>

          <!-- Image -->
          <img *ngIf="p.imageUrl" [src]="p.imageUrl" [alt]="p.name" class="card-img-top product-img" />
          <div *ngIf="!p.imageUrl" class="product-img-placeholder">
            <i class="bi bi-image text-muted fs-1"></i>
          </div>

          <!-- Category chip — full-width banner between image and body -->
          <div class="category-chip">{{ p.category }}</div>

          <!-- Body -->
          <div class="card-body d-flex flex-column px-3 pb-3 pt-2">
            <h6 class="product-name mb-2">{{ p.name }}</h6>
            <p class="product-price mb-2">₹{{ p.price.toFixed(2) }}</p>

            <div class="mt-auto btn-group btn-group-sm">
              <button class="btn btn-info text-white" (click)="view(p.id)">View</button>
              <button *ngIf="isAdmin" class="btn btn-warning text-dark" (click)="edit(p.id)">Edit</button>
              <button *ngIf="isAdmin" class="btn btn-danger" (click)="remove(p.id)">Delete</button>
              <button *ngIf="isUser" class="btn btn-success" (click)="addToCart(p)"
                      [disabled]="p.stockQuantity === 0">
                <i class="bi bi-cart-plus"></i> Add
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Pagination -->
    <nav *ngIf="displayedProducts.length > itemsPerPage"
         class="d-flex justify-content-center mt-5">
      <ul class="pagination pagination-lg shadow-sm rounded-pill bg-white px-3 py-2 align-items-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link rounded-pill px-4" (click)="prevPage()">← Previous</button>
        </li>
        <li class="page-item mx-3">
          <span class="fw-semibold text-primary">Page {{ currentPage }} of {{ totalPages }}</span>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link rounded-pill px-4" (click)="nextPage()">Next →</button>
        </li>
      </ul>
    </nav>

  </ng-container>

  <ng-template #noProducts>
    <div class="text-center py-5">
      <i class="bi bi-box2 text-muted" style="font-size: 3rem;"></i>
      <p class="text-muted fst-italic mt-2">No products available.</p>
    </div>
  </ng-template>

</div>
<style>
/* ══ Category Icon Grid Bar ══ */
.cat-grid-bar {
  background: #fff;
  border-bottom: 1px solid #e8eaf0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  padding: 14px 20px 10px;
}

.cat-grid-inner {
  display: flex;
  align-items: flex-start;
  gap: 6px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  padding-bottom: 4px;
}
.cat-grid-inner::-webkit-scrollbar { display: none; }

.cat-grid-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  background: none;
  border: none;
  cursor: pointer;
  flex-shrink: 0;
  width: 80px;
  padding: 0;
  transition: transform 0.15s ease;
  position: relative;
}

.cat-grid-item:hover {
  transform: translateY(-2px);
}

.cat-icon-wrap {
  width: 62px;
  height: 62px;
  border-radius: 50%;
  background: #f0f4ff;
  border: 2px solid #e0e8ff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: #2874f0;
  transition: all 0.18s ease;
  flex-shrink: 0;
}

.cat-grid-item:hover .cat-icon-wrap {
  background: #dce8ff;
  border-color: #2874f0;
  box-shadow: 0 4px 12px rgba(40,116,240,0.2);
}

.cat-grid-item.active .cat-icon-wrap {
  background: #2874f0;
  border-color: #1a5fd4;
  color: #fff;
  box-shadow: 0 4px 14px rgba(40,116,240,0.4);
}

.cat-label {
  font-size: 0.72rem;
  font-weight: 600;
  color: #444;
  text-align: center;
  line-height: 1.25;
  word-break: break-word;
  max-width: 74px;
  transition: color 0.15s;
}

.cat-grid-item.active .cat-label {
  color: #2874f0;
}

.cat-grid-item:hover .cat-label {
  color: #2874f0;
}

.cat-grid-count {
  position: absolute;
  top: -4px;
  right: 4px;
  background: #ff6161;
  color: #fff;
  font-size: 0.62rem;
  font-weight: 700;
  padding: 1px 5px;
  border-radius: 20px;
  border: 1.5px solid #fff;
  line-height: 1.4;
  min-width: 18px;
  text-align: center;
}

/* ══ Result bar ══ */
.result-info { border-bottom: 1px solid #ebebeb; padding-bottom: 10px; }
.clear-btn {
  border: none;
  background: none;
  color: #e53935;
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  padding: 0;
}
.clear-btn:hover { text-decoration: underline; }

/* ══ Product card ══ */
.product-card {
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(40,116,240,0.14) !important;
}
.product-img {
  height: 240px;
  object-fit: cover;
  width: 100%;
}
.product-img-placeholder {
  height: 240px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f5f5f5;
}
.category-chip {
  display: inline-block;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: #2874f0;
  background: #eef2ff;
  padding: 2px 8px;
  border-radius: 4px;
}
.product-name {
  font-size: 0.93rem;
  font-weight: 600;
  color: #212121;

  display: -webkit-box;
  line-clamp: 2;              /* ✅ standard property */
  -webkit-line-clamp: 2;      /* ✅ webkit fallback */
  -webkit-box-orient: vertical;

  overflow: hidden;
  line-height: 1.35;
}
.product-price {
  font-size: 1rem;
  font-weight: 700;
  color: #2874f0;
  margin: 0;
}

/* ══ Wishlist btn ══ */
.wishlist-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 2;
  background: rgba(255,255,255,0.92);
  border: none;
  border-radius: 50%;
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 1px 5px rgba(0,0,0,0.15);
  transition: transform 0.15s;
  padding: 0;
}
.wishlist-btn:hover { transform: scale(1.15); }

/* ══ Out of stock ══ */
.is-oos { opacity: 0.6; pointer-events: none; }
.oos-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.35);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3;
  border-radius: 12px;
}
.oos-overlay span {
  background: #222;
  color: #fff;
  font-size: 0.8rem;
  font-weight: 700;
  padding: 5px 14px;
  border-radius: 20px;
  letter-spacing: 0.05em;
}
.inactive-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 2;
  background: #757575;
  color: #fff;
  font-size: 0.68rem;
  font-weight: 700;
  padding: 3px 8px;
  border-radius: 4px;
  text-transform: uppercase;
}

@media (max-width: 576px) {
  .product-img { height: 180px; }
}
</style>
